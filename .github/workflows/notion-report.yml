name: Report to Notion

on:
  push:
    branches:
      - main

jobs:
  report:
    runs-on: ubuntu-latest

    steps:
      - name: Send commit info to Notion
        run: |
          curl -X POST https://api.notion.com/v1/pages \
          -H "Authorization: Bearer ${{ secrets.NOTION_TOKEN }}" \
          -H "Content-Type: application/json" \
          -H "Notion-Version: 2022-06-28" \
          -d '{
            "parent": {
              "database_id": "'"${{ secrets.NOTION_DATABASE_ID }}"'"
            },
            "properties": {
              "Name": {
                "title": [
                  { "text": { "content": "Commit pushed" } }
                ]
              },
              "Metric": {
                "select": { "name": "Commit" }
              },
              "Value": {
                "number": 1
              },
              "Source": {
                "select": { "name": "GitHub" }
              },
              "Date": {
                "date": { "start": "'"$(date -Iseconds)"'" }
              }
            }
          }'
